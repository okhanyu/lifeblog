<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>随想 on Hanyu FM</title><link>https://hanyu.cool/lifeblog/tags/%E9%9A%8F%E6%83%B3/</link><description>Recent content in 随想 on Hanyu FM</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sun, 02 Aug 2020 22:41:23 +0800</lastBuildDate><atom:link href="https://hanyu.cool/lifeblog/tags/%E9%9A%8F%E6%83%B3/index.xml" rel="self" type="application/rss+xml"/><item><title>我是生活二</title><link>https://hanyu.cool/lifeblog/posts/section-list/life/fourth/</link><pubDate>Sun, 02 Aug 2020 22:41:23 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/life/fourth/</guid><description>辛苦移步微信公众号点赞、在看、关注： 分布式锁 | 电商防超卖的N+1个坑！
大家好，我是西瓜。
今天和同事讨论库存防超卖问题，发现虽然只是简单的库存扣减场景，却隐藏着很多坑，一不小心就容易翻车，让西瓜推土机来填平这些坑。
单实例环境 一般电商体系防止库存超卖，主要有以下几种方式： 防止库存超卖，最先想到的可能就是「锁」，如果是一些单实例部署的库存服务，大部分情况下我们可以使用以下锁或并发工具类： 这三个任何一个都可以保证同一单位时间只有一个线程能够进行库存扣减，废话不多说，上码！
/** * 库存扣减（伪代码 ReentrantLock ) * @param stockRequestDTO * @return Boolean */ public Boolean stockHandle(StockRequestDTO stockRequestDTO) { // 日志打印...校验...前置处理等... int stock = stockMapper.getStock(stockRequestDTO.getGoodsId()); reentrantLock.lock(); try { int result = stock &amp;gt; 0 ? stockMapper.updateStock(stockRequestDTO.getGoodsId(), --stock) : 0; return result &amp;gt; 0 ? true : false; } catch (SQLException e) { // 异常日志打印及处理... return false; } finally { reentrantLock.unlock(); } } /** * 库存扣减（伪代码 synchronized ) * @param stockRequestDTO * @return Boolean */ public synchronized Boolean stockHandle(StockRequestDTO stockRequestDTO){ // 执行业务逻辑.</description></item><item><title>我是分类第三篇</title><link>https://hanyu.cool/lifeblog/posts/section-list/life/third/</link><pubDate>Sun, 02 Aug 2020 22:41:19 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/life/third/</guid><description/></item><item><title>我是分类第二篇</title><link>https://hanyu.cool/lifeblog/posts/section-list/life/second/</link><pubDate>Sun, 02 Aug 2020 22:41:02 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/life/second/</guid><description/></item><item><title>分类条目1</title><link>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-1/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-1/</guid><description/></item><item><title>分类条目2</title><link>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-2/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-2/</guid><description>asdsadad</description></item><item><title>分类条目3</title><link>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-3/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-3/</guid><description/></item><item><title>分类条目4</title><link>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-4/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-4/</guid><description/></item><item><title>我是分类第一篇</title><link>https://hanyu.cool/lifeblog/posts/section-list/life/first/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/life/first/</guid><description/></item><item><title>我是顶部右侧第一个Banner</title><link>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-first/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-first/</guid><description/></item><item><title>我是顶部右侧第三个Banner</title><link>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-third/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-third/</guid><description/></item><item><title>我是顶部右侧第二个Banner</title><link>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-second/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-second/</guid><description/></item><item><title>我是顶部右侧第四个Banner</title><link>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-fourth/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-fourth/</guid><description/></item></channel></rss>