<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Hanyu FM</title><link>https://hanyu.cool/lifeblog/</link><description>Recent content on Hanyu FM</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Tue, 23 Mar 2021 22:40:49 +0800</lastBuildDate><atom:link href="https://hanyu.cool/lifeblog/index.xml" rel="self" type="application/rss+xml"/><item><title>我是大banner</title><link>https://hanyu.cool/lifeblog/posts/section-list/life/top-banner-left/</link><pubDate>Tue, 23 Mar 2021 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/life/top-banner-left/</guid><description>辛苦移步微信公众号点赞、在看、关注： 分布式锁 | 电商防超卖的N+1个坑！
大家好，我是西瓜。
今天和同事讨论库存防超卖问题，发现虽然只是简单的库存扣减场景，却隐藏着很多坑，一不小心就容易翻车，让西瓜推土机来填平这些坑。
单实例环境 一般电商体系防止库存超卖，主要有以下几种方式： 防止库存超卖，最先想到的可能就是「锁」，如果是一些单实例部署的库存服务，大部分情况下我们可以使用以下锁或并发工具类： 这三个任何一个都可以保证同一单位时间只有一个线程能够进行库存扣减，废话不多说，上码！
/** * 库存扣减（伪代码 ReentrantLock ) * @param stockRequestDTO * @return Boolean */ public Boolean stockHandle(StockRequestDTO stockRequestDTO) { // 日志打印...校验...前置处理等... int stock = stockMapper.getStock(stockRequestDTO.getGoodsId()); reentrantLock.lock(); try { int result = stock &amp;gt; 0 ? stockMapper.updateStock(stockRequestDTO.getGoodsId(), --stock) : 0; return result &amp;gt; 0 ? true : false; } catch (SQLException e) { // 异常日志打印及处理... return false; } finally { reentrantLock.unlock(); } } /** * 库存扣减（伪代码 synchronized ) * @param stockRequestDTO * @return Boolean */ public synchronized Boolean stockHandle(StockRequestDTO stockRequestDTO){ // 执行业务逻辑.</description></item><item><title>我是大banner</title><link>https://hanyu.cool/lifeblog/posts/section-top-left/top-banner-left/</link><pubDate>Tue, 23 Mar 2021 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-top-left/top-banner-left/</guid><description>辛苦移步微信公众号点赞、在看、关注： 分布式锁 | 电商防超卖的N+1个坑！
大家好，我是西瓜。
今天和同事讨论库存防超卖问题，发现虽然只是简单的库存扣减场景，却隐藏着很多坑，一不小心就容易翻车，让西瓜推土机来填平这些坑。
单实例环境 一般电商体系防止库存超卖，主要有以下几种方式： 防止库存超卖，最先想到的可能就是「锁」，如果是一些单实例部署的库存服务，大部分情况下我们可以使用以下锁或并发工具类： 这三个任何一个都可以保证同一单位时间只有一个线程能够进行库存扣减，废话不多说，上码！
/** * 库存扣减（伪代码 ReentrantLock ) * @param stockRequestDTO * @return Boolean */ public Boolean stockHandle(StockRequestDTO stockRequestDTO) { // 日志打印...校验...前置处理等... int stock = stockMapper.getStock(stockRequestDTO.getGoodsId()); reentrantLock.lock(); try { int result = stock &amp;gt; 0 ? stockMapper.updateStock(stockRequestDTO.getGoodsId(), --stock) : 0; return result &amp;gt; 0 ? true : false; } catch (SQLException e) { // 异常日志打印及处理... return false; } finally { reentrantLock.unlock(); } } /** * 库存扣减（伪代码 synchronized ) * @param stockRequestDTO * @return Boolean */ public synchronized Boolean stockHandle(StockRequestDTO stockRequestDTO){ // 执行业务逻辑.</description></item><item><title>我是生活二</title><link>https://hanyu.cool/lifeblog/posts/section-list/life/fourth/</link><pubDate>Sun, 02 Aug 2020 22:41:23 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/life/fourth/</guid><description>辛苦移步微信公众号点赞、在看、关注： 分布式锁 | 电商防超卖的N+1个坑！
大家好，我是西瓜。
今天和同事讨论库存防超卖问题，发现虽然只是简单的库存扣减场景，却隐藏着很多坑，一不小心就容易翻车，让西瓜推土机来填平这些坑。
单实例环境 一般电商体系防止库存超卖，主要有以下几种方式： 防止库存超卖，最先想到的可能就是「锁」，如果是一些单实例部署的库存服务，大部分情况下我们可以使用以下锁或并发工具类： 这三个任何一个都可以保证同一单位时间只有一个线程能够进行库存扣减，废话不多说，上码！
/** * 库存扣减（伪代码 ReentrantLock ) * @param stockRequestDTO * @return Boolean */ public Boolean stockHandle(StockRequestDTO stockRequestDTO) { // 日志打印...校验...前置处理等... int stock = stockMapper.getStock(stockRequestDTO.getGoodsId()); reentrantLock.lock(); try { int result = stock &amp;gt; 0 ? stockMapper.updateStock(stockRequestDTO.getGoodsId(), --stock) : 0; return result &amp;gt; 0 ? true : false; } catch (SQLException e) { // 异常日志打印及处理... return false; } finally { reentrantLock.unlock(); } } /** * 库存扣减（伪代码 synchronized ) * @param stockRequestDTO * @return Boolean */ public synchronized Boolean stockHandle(StockRequestDTO stockRequestDTO){ // 执行业务逻辑.</description></item><item><title>我是分类第三篇</title><link>https://hanyu.cool/lifeblog/posts/section-list/life/third/</link><pubDate>Sun, 02 Aug 2020 22:41:19 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/life/third/</guid><description/></item><item><title>我是分类第二篇</title><link>https://hanyu.cool/lifeblog/posts/section-list/life/second/</link><pubDate>Sun, 02 Aug 2020 22:41:02 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/life/second/</guid><description/></item><item><title>分类条目1</title><link>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-1/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-1/</guid><description/></item><item><title>分类条目2</title><link>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-2/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-2/</guid><description>asdsadad</description></item><item><title>分类条目3</title><link>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-3/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-3/</guid><description/></item><item><title>分类条目4</title><link>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-4/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/category/category-item-4/</guid><description/></item><item><title>广告1</title><link>https://hanyu.cool/lifeblog/posts/section-bottom-ad/ad-1/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-bottom-ad/ad-1/</guid><description>asdad</description></item><item><title>广告边栏</title><link>https://hanyu.cool/lifeblog/posts/section-list-sidecar/side-item-img/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list-sidecar/side-item-img/</guid><description>asd</description></item><item><title>广告边栏1</title><link>https://hanyu.cool/lifeblog/posts/section-list-sidecar/side-item-article-1/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list-sidecar/side-item-article-1/</guid><description>asd</description></item><item><title>广告边栏2</title><link>https://hanyu.cool/lifeblog/posts/section-list-sidecar/side-item-article-2/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list-sidecar/side-item-article-2/</guid><description>asd</description></item><item><title>广告边栏3</title><link>https://hanyu.cool/lifeblog/posts/section-list-sidecar/side-item-article-3/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list-sidecar/side-item-article-3/</guid><description>asd</description></item><item><title>我是一篇技术文章</title><link>https://hanyu.cool/lifeblog/posts/section-card/tech/first/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/tech/first/</guid><description/></item><item><title>我是一篇技术文章</title><link>https://hanyu.cool/lifeblog/posts/section-card/tech/first%E7%9A%84%E5%89%AF%E6%9C%AC/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/tech/first%E7%9A%84%E5%89%AF%E6%9C%AC/</guid><description/></item><item><title>我是一篇技术文章</title><link>https://hanyu.cool/lifeblog/posts/section-card/tech/first%E7%9A%84%E5%89%AF%E6%9C%AC2/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/tech/first%E7%9A%84%E5%89%AF%E6%9C%AC2/</guid><description/></item><item><title>我是一篇技术文章</title><link>https://hanyu.cool/lifeblog/posts/section-card/tech/first%E7%9A%84%E5%89%AF%E6%9C%AC3/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/tech/first%E7%9A%84%E5%89%AF%E6%9C%AC3/</guid><description/></item><item><title>我是一篇技术文章</title><link>https://hanyu.cool/lifeblog/posts/section-card/tech/first%E7%9A%84%E5%89%AF%E6%9C%AC4/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/tech/first%E7%9A%84%E5%89%AF%E6%9C%AC4/</guid><description/></item><item><title>我是一篇技术文章</title><link>https://hanyu.cool/lifeblog/posts/section-card/tech/first%E7%9A%84%E5%89%AF%E6%9C%AC5/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/tech/first%E7%9A%84%E5%89%AF%E6%9C%AC5/</guid><description/></item><item><title>我是一篇技术文章</title><link>https://hanyu.cool/lifeblog/posts/section-card/tech/first%E7%9A%84%E5%89%AF%E6%9C%AC6/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/tech/first%E7%9A%84%E5%89%AF%E6%9C%AC6/</guid><description/></item><item><title>我是一篇摄影文</title><link>https://hanyu.cool/lifeblog/posts/section-list/photo/first/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/photo/first/</guid><description/></item><item><title>我是一篇摄影文</title><link>https://hanyu.cool/lifeblog/posts/section-list/photo/first%E7%9A%84%E5%89%AF%E6%9C%AC/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/photo/first%E7%9A%84%E5%89%AF%E6%9C%AC/</guid><description/></item><item><title>我是一篇摄影文</title><link>https://hanyu.cool/lifeblog/posts/section-list/photo/first%E7%9A%84%E5%89%AF%E6%9C%AC2/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/photo/first%E7%9A%84%E5%89%AF%E6%9C%AC2/</guid><description/></item><item><title>我是一篇摄影文</title><link>https://hanyu.cool/lifeblog/posts/section-list/photo/first%E7%9A%84%E5%89%AF%E6%9C%AC4/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/photo/first%E7%9A%84%E5%89%AF%E6%9C%AC4/</guid><description/></item><item><title>我是一篇摄影文</title><link>https://hanyu.cool/lifeblog/posts/section-list/photo/first%E7%9A%84%E5%89%AF%E6%9C%AC5/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/photo/first%E7%9A%84%E5%89%AF%E6%9C%AC5/</guid><description/></item><item><title>我是一篇美食</title><link>https://hanyu.cool/lifeblog/posts/section-list/food/first%E7%9A%84%E5%89%AF%E6%9C%AC-2/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/food/first%E7%9A%84%E5%89%AF%E6%9C%AC-2/</guid><description/></item><item><title>我是一篇美食文3</title><link>https://hanyu.cool/lifeblog/posts/section-list/food/first%E7%9A%84%E5%89%AF%E6%9C%AC/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/food/first%E7%9A%84%E5%89%AF%E6%9C%AC/</guid><description/></item><item><title>我是一篇美食文5</title><link>https://hanyu.cool/lifeblog/posts/section-list/food/first/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/food/first/</guid><description>爱上了决胜巅峰第三方但是</description></item><item><title>我是一篇视频</title><link>https://hanyu.cool/lifeblog/posts/section-card/vlog/first/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/vlog/first/</guid><description/></item><item><title>我是一篇视频</title><link>https://hanyu.cool/lifeblog/posts/section-card/vlog/first%E7%9A%84%E5%89%AF%E6%9C%AC/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/vlog/first%E7%9A%84%E5%89%AF%E6%9C%AC/</guid><description/></item><item><title>我是一篇视频</title><link>https://hanyu.cool/lifeblog/posts/section-card/vlog/first%E7%9A%84%E5%89%AF%E6%9C%AC2/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/vlog/first%E7%9A%84%E5%89%AF%E6%9C%AC2/</guid><description/></item><item><title>我是一篇视频</title><link>https://hanyu.cool/lifeblog/posts/section-card/vlog/first%E7%9A%84%E5%89%AF%E6%9C%AC3/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/vlog/first%E7%9A%84%E5%89%AF%E6%9C%AC3/</guid><description/></item><item><title>我是一篇视频</title><link>https://hanyu.cool/lifeblog/posts/section-card/vlog/first%E7%9A%84%E5%89%AF%E6%9C%AC4/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/vlog/first%E7%9A%84%E5%89%AF%E6%9C%AC4/</guid><description/></item><item><title>我是一篇视频</title><link>https://hanyu.cool/lifeblog/posts/section-card/vlog/first%E7%9A%84%E5%89%AF%E6%9C%AC5/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/vlog/first%E7%9A%84%E5%89%AF%E6%9C%AC5/</guid><description/></item><item><title>我是一篇视频</title><link>https://hanyu.cool/lifeblog/posts/section-card/vlog/first%E7%9A%84%E5%89%AF%E6%9C%AC6/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/vlog/first%E7%9A%84%E5%89%AF%E6%9C%AC6/</guid><description/></item><item><title>我是一篇足球文</title><link>https://hanyu.cool/lifeblog/posts/section-list/photo/first%E7%9A%84%E5%89%AF%E6%9C%AC3/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/photo/first%E7%9A%84%E5%89%AF%E6%9C%AC3/</guid><description/></item><item><title>我是分类第一篇</title><link>https://hanyu.cool/lifeblog/posts/section-list/life/first/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-list/life/first/</guid><description/></item><item><title>我是顶部右侧第一个Banner</title><link>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-first/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-first/</guid><description/></item><item><title>我是顶部右侧第三个Banner</title><link>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-third/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-third/</guid><description/></item><item><title>我是顶部右侧第二个Banner</title><link>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-second/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-second/</guid><description/></item><item><title>我是顶部右侧第四个Banner</title><link>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-fourth/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-top-right/top-banner-right-fourth/</guid><description/></item><item><title>推荐文章左大</title><link>https://hanyu.cool/lifeblog/posts/section-card/recommend/recom-item-left/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/recommend/recom-item-left/</guid><description/></item><item><title>推荐文章里1</title><link>https://hanyu.cool/lifeblog/posts/section-card/recommend/recom-item-1/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/recommend/recom-item-1/</guid><description/></item><item><title>推荐文章里2</title><link>https://hanyu.cool/lifeblog/posts/section-card/recommend/recom-item-2/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/recommend/recom-item-2/</guid><description/></item><item><title>推荐文章里3</title><link>https://hanyu.cool/lifeblog/posts/section-card/recommend/recom-item-3/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/recommend/recom-item-3/</guid><description/></item><item><title>推荐文章里4</title><link>https://hanyu.cool/lifeblog/posts/section-card/recommend/recom-item-4/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/recommend/recom-item-4/</guid><description/></item><item><title>推荐文章里5</title><link>https://hanyu.cool/lifeblog/posts/section-card/recommend/recom-item-5/</link><pubDate>Sun, 02 Aug 2020 22:40:49 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/recommend/recom-item-5/</guid><description/></item><item><title>旅行篇</title><link>https://hanyu.cool/lifeblog/posts/section-card/travel/banner/</link><pubDate>Sun, 02 Aug 2020 22:26:33 +0800</pubDate><guid>https://hanyu.cool/lifeblog/posts/section-card/travel/banner/</guid><description>你好 哈哈哈哈哈 我是正文</description></item></channel></rss>